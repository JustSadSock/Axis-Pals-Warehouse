# Axis Pals: Warehouse

Кооперативная top-down головоломка про двух квадратов, которые двигаются вместе: один игрок отвечает за горизонталь, второй — за вертикаль. Если одному мешает стена, второй всё равно сдвинется, поэтому взаимное положение постоянно меняется. У каждого есть своя цветная цель, и на уровне задаётся лимит ходов под выбранную сложность (Easy/Medium/Hard) на основе расчёта топовых решений. Работает локально на одной клавиатуре или онлайн через WebSocket-сервер (готов к запуску за Cloudflare Tunnel).

## Запуск

### Установка зависимостей
```bash
npm ci
```

### Локальный сервер
```bash
npm run dev
```
Откройте http://localhost:3000.

### WebSocket URL
Клиент сам использует `location.host` и выбирает `ws://` или `wss://` в зависимости от протокола. Это работает и локально, и через публичный туннель.

### Батник с Cloudflare Tunnel
В Windows используйте скрипт:
```bat
run-axis-pals.bat
```
Он проверит Node/npm, поставит зависимости, запустит локальный сервер, поднимет туннель `cloudflared` и запишет адреса в `scripts/.axis-pals-tunnel.env`.

## Управление
- Игрок 1: **W / S** — сдвигает оба объекта по вертикали.
- Игрок 2: стрелки **← →** — сдвигает оба по горизонтали.
- Каждый игрок должен встать на свою цветную цель.
- Если одному мешает стена, второй продолжит движение.
- `R` или кнопка "Перезапуск уровня" — сбрасывает текущий уровень в локальном режиме.

## Локальный кооп
- При старте появляется экран выбора режима с крупными кнопками: локально (по умолчанию), онлайн и бесконечный режим.
- После выбора локального режима показывается HUD с подсказками для обоих игроков и список уровней для быстрого выбора.
- Цель каждого уровня — поставить оба квадрата на свои цветные точки, при этом выбранная сложность задаёт лимит ходов: Easy (20-й лучший маршрут), Medium (5-й), Hard (2-й).
- Для рестарта текущего уровня нажмите `R` или кнопку в панели, можно менять сложность чипами рядом.

## Бесконечный режим
- Генерирует новые уровни локально, каждый следующий немного сложнее (больше стен).
- Перед выдачей уровня запускается проверка проходимости (поиск в ширину) с расчётом лимитов ходов, чтобы не попадались безвыходные конфигурации.
- После победы автоматически загружается следующая волна.

## Структура
- `server/server.js` — Express + WebSocket (`/ws`), комната на 2 игрока, сервер — источник состояния.
- `public/` — статика (канвас-рендер, уровни, общая игровая логика, сетевой клиент).
- `run-axis-pals.bat` — быстрый запуск локального сервера и Cloudflare Tunnel.

## Логика
- `public/gameLogic.js` — единый модуль для сервера и клиента (проверки стен, одновременное движение, победа по персональным целям).
- `public/levels.js` — 5 уровней с акцентом на синхронные оси и персональные цели.
- `public/solver.js` — поиск решений, собирает до 50 самых коротких маршрутов и задаёт лимиты ходов для Easy/Medium/Hard.

Приятного кооператива!
